<!doctype html>
<html lang="bg-BG">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <style>
      
    body, html {
        margin: 0;
        overflow: hidden;
        height:100%;
      }
    
    .no-spin::-webkit-inner-spin-button,
    .no-spin::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }   
    
    @media print {
      body, html {
        height: auto;
        overflow: visible;
      }
      body * {
        visibility: hidden;
      }
      
      div.tab-pane.active, div.tab-pane.active * {
        visibility: visible;
      }
      
/*******************************************      
      div.tab-pane.active{
        position: absolute;
        left: 0;
        top: 0;
      }
********************************************/       
      form {
        height: auto;
      }
     
    }
    
    @page {
      size: A3;
      margin-top: 2cm;
      margin-bottom: 2cm;
    } 

  </style>
  <title>Д-р Арабаджикова</title>
</head>

<body>
  <nav class="navbar navbar-expand-sm navbar-light bg-light">
    <span class="navbar-brand d-none d-sm-block mb-0 h1">Меню:</span>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup">
			<span class="navbar-toggler-icon"></span>
		</button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <div class="nav nav-pills nav-tabs mr-auto flex-column flex-sm-row" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active text-center" id="uzd" data-toggle="tab" href="#nav-uzd" role="tab" controls="data">УЗД</a>
        <a class="nav-item nav-link text-center" id="nav-admin-tab" data-toggle="tab" href="#nav-admin" role="tab" controls="admin">Settings</a>
        <a class="nav-item nav-link text-center" id="nav-about-tab" data-toggle="modal" href="#nav-about" role="tab" data-target="#nav-about">About</a>
      </div>
    </div>
  </nav>
  <div class="container-fluid">
    <div class = "row">
      <div class = "col-3 flex-column d-none d-lg-flex d-print-none border">
        <div listHeader>
          <div class="d-flex justify-content-left mt-3" buttonsbar2>
            <button type="button" class="btn btn-primary mx-1" new>Нов</button>
            <button type="button" class="btn btn-primary mx-1" logout>Изход</button>
          </div>
          <hr class="mx-0">
          <label>Търсене</label>
          <input class = "form-control" type="text" id="patientSearchPrefix">
          <hr class="mx-0">
        </div>
        <div class="list-group" id="patientList"></div>
      </div>  
      <div class = "col border">
        <div class="tab-content mt-0">
          <div class="tab-pane fade show active" id="nav-uzd" role="tabpanel">
            <div class="container d-flex flex-column px-0">              
              <form class="mb-0 px-3" id="uzd">        
                <p class="h2 text-center mt-1">Ултразвукова Пренатална Диагностика</p>
                <hr>                
                <div class="form-row">
                  <div class="form-group col-md-8">
                    <label for="patient_name">Пациент</label>
                    <input type="text" class="form-control" id="patient_name" placeholder="име фамилия">
                  </div>
                  <div class="form-group col-md-2">
                    <label for="patient_name">ЕГН</label>
                    <input type="number" class="form-control no-spin" id="patient_egn">
                  </div>                  
                  <div class="form-group col-md-2">
                    <label for="patient_age">Възраст</label>
                    <input type="number" class="form-control" min="10" max="99" id="patient_age">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-12">
                    <label for="inputAddress">Адрес</label>
                    <input type="text" class="form-control" id="inputAddress">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md">
                    <label for="prm">ПРМ</label>
                    <input type="date" class="form-control" id="prm">
                  </div>
                  <div class="form-group col-md">
                    <label for="exam_date">Дата УЗИ</label>
                    <input type="date" class="form-control" id="exam_date">
                  </div>
                  <div class="form-group col-md">
                    <label for="gv_po_prm">ГВ по ПРМ</label>
                    <div class="input-group">
                      <input type="number" class="form-control" min="0" max="50" id="gv_po_prm_weeks">
                      <div class="input-group-append"><span class="input-group-text">с.</span></div>
                      <input type="number" class="form-control" min="0" max="6" id="gv_po_prm_days">
                      <div class="input-group-append"><span class="input-group-text">дни</span></div>
                    </div>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md">
                    <label for="vtr">ВТР</label>
                    <input type="date" class="form-control" id="vtr">
                  </div>
                  <div class="form-group col-md">
                    <label for="corrected_vtr">Коригиран ВТР</label>
                    <input type="date" class="form-control" id="corrected_vtr">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-12">
                    <label for="anamneza">Акушерска анамнеза</label>
                    <input type="text" class="form-control" id="anamneza" value="Бременност по ред" placeholder="Бременност по ред">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-12">
                    <label for="family_predisposition">Фамилна обремененост</label>
                    <input type="text" class="form-control" id="family_predisposition">
                  </div>
                </div>
                <hr>
                <p class="h5 text-center">УЗД</p>
                <div class="form-row">
                  <div class="form-group col-md-10 mt-0 mb-1">
                    <label class="my-0" for="predlezhanie">Предлежание</label>
                    <input type="text" class="form-control form-control-sm" id="predlezhanie">
                  </div>
                  <div class="form-group col-md-2 mt-0 mb-1">
                    <label class="my-0">Пол</label>
                    <div class="form-group">
                      <div class="custom-control custom-radio custom-control-inline">
                        <input class="custom-control-input" type="radio" name="sexRadios" id="sex_male" value="male">
                        <label class="custom-control-label" for="sex_male">M</label>
                      </div>
                      <div class="custom-control custom-radio custom-control-inline">
                        <input class="custom-control-input" type="radio" name="sexRadios" id="sex_female" value="female">
                        <label class="custom-control-label" for="sex_female">F</label>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-10 mt-0 mb-1">
                    <label class="my-0" for="fetal_movements">Движение на плода</label>
                    <input type="text" class="form-control form-control-sm" id="fetal_movements">
                  </div>
                  <div class="form-group col-md-2 mt-0 mb-1">
                    <label class="my-0" for="featal_heart_rate">СЧП</label>
                    <div class="input-group input-group-sm">
                      <input type="number" class="form-control" min="0" id="featal_heart_rate">
                      <div class="input-group-append"><span class="input-group-text">уд/мин</span></div>
                    </div>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-12 mt-0 mb-1">
                    <label class="my-0" for="placenta">Плацента</label>
                    <input type="text" class="form-control form-control-sm" id="placenta">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-12 mt-0 mb-1">
                    <label class="my-0" for="papna_vrav">Пъпна връв</label>
                    <input type="text" class="form-control form-control-sm" id="papna_vrav">
                  </div>
                </div>
                <hr>
                <p class="h5 text-center">Биометрия</p>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">BPD</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="bpd2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="bpd_mm" purpose="biometric" ga_dating="bpd2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control no-spin" min="0" id="bpd_gs" purpose="biometric" ga_dating="bpd2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose = "biometric" ga_dating="bpd2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">OFD</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="ofd2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="ofd_mm" purpose="biometric" ga_dating="ofd2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control no-spin" min="0" id="ofd_gs" purpose="biometric" ga_dating="ofd2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="ofd2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">HC</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="hc2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="hc_mm"  purpose="biometric" ga_dating="hc2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control no-spin" min="0" id="hc_gs"  purpose="biometric" ga_dating="hc2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="hc2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">Vp</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="vp2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="vp_mm"  purpose="biometric" ga_dating="vp2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control" min="0" id="vp_gs"  purpose="biometric" ga_dating="vp2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="vp2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">TCD</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="tcd2ga"></select></div>                    
                          <input type="number" class="form-control no-spin" step="any" min="0" id="tcd_mm" purpose="biometric" ga_dating="tcd2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control" min="0" id="tcd_gs" purpose="biometric" ga_dating="tcd2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="tcd2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">CM</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="cm2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="cm_mm"  purpose="biometric" ga_dating="cm2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control" min="0" id="cm_gs"  purpose="biometric" ga_dating="cm2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="cm2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">NF</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="nf2ga"></select></div>
                          <input type="number" class="form-control" min="0" step="any" id="nf_mm"  purpose="biometric" ga_dating="nf2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="number" class="form-control" min="0" id="nf_gs"  purpose="biometric" ga_dating="nf2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="nf2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">NB</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="nb2ga"></select></div>
                          <input type="number" class="form-control" min="0" step="any" id="nb_mm" purpose="biometric" ga_dating="nb2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="number" class="form-control" min="0" id="nb_gs" purpose="biometric" ga_dating="nb2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="nb2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-2  my-0">APAD</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="apad2ga"></select></div>
                          <input type="number" class="form-control" min="0" step="any" id="apad_mm" purpose="biometric" ga_dating="apad2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="number" class="form-control" min="0" id="apad_gs" purpose="biometric" ga_dating="apad2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="apad2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group  mt-0 mb-1">
                        <label class="mr-1  my-0">TAD</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="tad2ga"></select></div>
                          <input type="number" class="form-control" min="0" step="any" id="tad_mm" purpose="biometric" ga_dating="tad2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="number" class="form-control" min="0" id="tad_gs" purpose="biometric" ga_dating="tad2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="tad2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group mt-0 mb-1">
                        <label class="mr-2 my-0">AC</label>
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="ac2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="ac_mm"  purpose="biometric" ga_dating="ac2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control" min="0" id="ac_gs"  purpose="biometric" ga_dating="ac2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="ac2ga"></span></small>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group mt-0 mb-1">
                        <label class="mr-2 my-0">FL</label>
                        <div class="input-group input-group-sm">
                           <div class="input-group-prepend"><select class="form-control form-control-sm" purpose="biometric" ga_dating="fl2ga"></select></div>
                          <input type="number" class="form-control no-spin" step="any" min="0" id="fl_mm"  purpose="biometric" ga_dating="fl2ga-input">
                          <div class="input-group-append"><span class="input-group-text">mm</span></div>
                          <input type="tel" class="form-control" min="0" id="fl_gs"  purpose="biometric" ga_dating="fl2ga-output">
                          <div class="input-group-append"><span class="input-group-text">с+д</span></div>
                        </div>
                        <small><span class="form-text text-muted mt-0" purpose="biometric" ga_dating="fl2ga"></span></small>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md">
                    <div class="form-group mt-0 mb-1">
                      <label class="mr-1 my-0">EFW</label>
                        <div class="input-group input-group-sm">
                          <input type="number" class="form-control" step="any" min="0" id="efw_mm">
                          <div class="input-group-append"><span class="input-group-text">g</span></div>
                        </div>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group mt-0 mb-1">
                      <label class="mr-1 my-0">LA</label>
                      <div class="input-group input-group-sm"><input type="text" class="form-control" min="0" id="la"></div>
                    </div>
                  </div>
                  <div class="col-md">
                    <div class="form-group mt-0 mb-1">
                      <label class="mr-1 my-0">LC</label>
                        <div class="input-group input-group-sm"><input type="text" class="form-control" min="0" id="lc"></div>
                    </div>
                  </div>
                </div>
                <hr>
                <p class="h5 text-center">Анатомия на плода</p>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Глава</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="head"></div>
                  <label class="col-md-2 col-form-label mr-1 text-md-right">Мозък</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="brain"></div>
                </div>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Лице</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="face"></div>
                  <label class="col-md-2 col-form-label mr-1 text-md-right">Шия/Кожа</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="neck_skin"></div>
                </div>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Гръбначен стълб</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="spine"></div>
                  <label class="col-md-2 col-form-label mr-1 text-md-right">Гръден кош</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="chest"></div>
                </div>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Сърце</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="heart"></div>
                  <label class="col-md-2 col-form-label mr-1 text-md-right">Корем</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="belly"></div>
                </div>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Бъбреци</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="kidney"></div>
                  <label class="col-md-2 col-form-label mr-1 text-md-right">Крайници</label>
                  <div class="col-md"><input type="text" class="form-control form-control-sm" id="arms"></div>
                </div>
                <div class="form-group row my-0">
                  <label class="col-md-2 col-form-label mr-1">Скелет</label>
                  <div class="col-md-4"><input type="text" class="form-control form-control-sm" id="skeleton"></div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label pr-0">A. ut. Dex</label>
                      <div class="col-md">
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><span class="input-group-text">PI</span></div>
                          <input type="number" class="form-control no-spin" min="0" id="autdex_pi">
                          <div class="input-group-prepend"><span class="input-group-text">RI</span></div>
                          <input type="number" class="form-control no-spin" min="0" id="autdex_ri">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label pr-0">A. ut. Sin</label>
                      <div class="col-md">
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><span class="input-group-text">PI</span></div>
                          <input type="number" class="form-control" min="0" id="autsin_pi">
                          <div class="input-group-prepend"><span class="input-group-text">RI</span></div>
                          <input type="number" class="form-control" min="0" id="autsin_ri">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label ">A. umb.</label>
                      <div class="col-md">
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><span class="input-group-text">PI</span></div>
                          <input type="number" class="form-control" min="0" id="aumb_pi">
                          <div class="input-group-prepend"><span class="input-group-text">RI</span></div>
                          <input type="number" class="form-control" min="0" id="aumb_ri">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label">CMA</label>
                      <div class="col-md">
                        <div class="input-group input-group-sm">
                          <div class="input-group-prepend"><span class="input-group-text">PI</span></div>
                          <input type="number" class="form-control no-spin" min="0" id="cma_pi">
                          <div class="input-group-prepend"><span class="input-group-text">PSV</span></div>
                          <input type="number" class="form-control no-spin" min="0" id="cma_psv">
                          <div class="input-group-append"><span class="input-group-text">mm/sec</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label">CPR</label>
                      <div class="col-md">
                          <input type="number" class="form-control form-control-sm no-spin" min="0" id="cpr">
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group row my-0">
                      <label class="col-md-2 col-form-label pr-0 mr-1">Duc. Ven.</label>
                      <div class="col-md">
                        <div class="input-group input-group-sm">
                          <input type="number" class="form-control form-control-sm no-spin" min="0" id="duc_ven">
                          <div class="input-group-append"><span class="input-group-text">mm/sec</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <hr>
                <p class="h5 text-center">Коментар</p>
                <div class="col-md"><input type="text" class="form-control form-control-sm" id="comment"></div>
                <hr>
                <p class="h6 text-center">Забележка</p>
                <ul>
                  <li class="pb-0 mb-0"><small>Някои вродени аномалии на плода не могат да бъдат диагностицирани при ултразвуково изследване.</small></li>
                  <li class="pt-0 mt-0"><small>Хромозомните аномалии на плода не могат да се диагностицират чрез ултразвук.</small></li>
                </ul>
              </form>
              <div class="d-flex justify-content-around my-3" buttonsbar1>
                <button type="button" class="btn btn-lg btn-primary w-50 m-1 d-print-none" save>Запис</button>
                <button type="button" class="btn btn-lg btn-primary w-50 m-1 d-print-none" print>Печат</button>
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="nav-admin" role="tabpanel">
            <label  class="form-label">accessKeyId</label>
            <input type="text" class="form-control" id="accessKeyId">
            <label  class="form-label">secretAccessKey</label>
            <input type="text" class="form-control" id="secretAccessKey">
            <button type="button" class="btn btn-lg btn-primary" access>Запис</button>
          </div>
          <div class="modal fade" id="nav-about" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" >About...</h5>
                  <button type="button" class="close" data-dismiss="modal" >
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>Д-р Арабаджикова v1.3.0<br>
                  BelianovSoft &copy 2018</p>
                  <p>
                    Change log:<br>
                    v1.3.0 - Access to patient data is now with username and password
                  </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>          
        </div>
      </div>
    </div>
  </div>
  
  <!-- gerneral purpose modal dialog for showing info messages-->
  <div class="modal fade" id="modalInfo" tabindex="-1">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p></p>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
  <script>
    function showInfo(title, content, callback = null){
      $("div.modal#modalInfo h5.modal-title").html(title);
      $("div.modal#modalInfo div.modal-body p").html(content);
      $("div.modal#modalInfo div.modal-footer").html("");
      $("div.modal#modalInfo").off("hidden.bs.modal");
      $("div.modal#modalInfo div.modal-footer").append('<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal" close>Close</button>');
      if (callback && typeof callback == 'function'){
        $("div.modal#modalInfo div.modal-footer").append('<button type="button" class="btn btn-primary btn-sm" ok>OK</button>');
        $("div.modal#modalInfo div.modal-footer button[ok]").click(function(){
          $("div.modal#modalInfo").modal('hide');
          $("div.modal#modalInfo").one("hidden.bs.modal", function(){
             callback();
          });
        });
      }
      $("div.modal#modalInfo").modal('show');
    }
  </script>
  
  <!--Login modal dialog -->
  <div class="modal fade" id="modalLogin" tabindex="-1">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Log-in Dialog</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
              <label for="user-name" class="col-form-label">User:</label>
              <input type="text" class="form-control" id="user-name">
            </div>
            <div class="form-group">
              <label for="password" class="col-form-label">Password:</label>
              <input type="password" class="form-control" id="password"></input>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" ok>Log-in</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    function requestUserLoginInfo(cb_dynamoDB_op /*DynamoDB operation to be executed as callback after login*/){
      //clear the password field to show the user we do not like his password
      $("div.modal#modalLogin input#password").val("");
      $("div.modal#modalLogin div.modal-footer button[ok]").one("click", function(){
          $("div.modal#modalLogin").modal('hide');
          $("div.modal#modalLogin").one("hidden.bs.modal", function(){
             executeDdbOperation(cb_dynamoDB_op);
          });
        });
      $("div.modal#modalLogin").modal("show");
    
    }
  </script>
  
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.203.0.min.js"></script>
	<!--<script src="http://lozen.arabadjikova.com/tempmon/js/SigV4Utils.js"></script>-->
  <script src="ga_dating_functions.js"></script>
  <script src="amazon-cognito-identity.js"></script>
  
  <script>
		AWS.config.update({region: "us-east-1"});//, dynamoDbCrc32: false});
		//AWS.config.update({accessKeyId: '', secretAccessKey: ''});
    
    var patientRetentionPeriod = 10; //years
    var accessKeyId = localStorage.getItem("accessKeyId");
    var secretAccessKey = localStorage.getItem("secretAccessKey");
    var poolData = { 
        UserPoolId : 'us-east-1_njMWzfgEG',
        ClientId : '2p3alhctu4e6d4fkunpctc8qd'
      };
    var credentials = new AWS.CognitoIdentityCredentials({
        IdentityPoolId: 'us-east-1:0ee125bb-925d-4880-9623-109b25e17574',
        Logins: {
          'cognito-idp.us-east-1.amazonaws.com/us-east-1_njMWzfgEG': ''
        }
    });
    //will be used to properly handle authenitacation flow
    //true, means that refreshng credential is not possible
    var credentialsRefreshFailed = true;
    
//     function getDynamoDB(){
//       var dynamodb = new AWS.DynamoDB({
//           apiVersion: '2012-08-10',
//           dynamoDbCrc32: false,
//           accessKeyId: accessKeyId,
//           secretAccessKey: secretAccessKey
//         });          
//       return dynamodb;
//     }
    
    function propagatePatientList(){
      $("div#patientList").html("");
      readPatientDB();
    }
    
    function readPatientDB(start_key){
      
      var params = {
        TableName: "patientDDB",
        ProjectionExpression: "patientName",
        Limit: 25,
        //ExpressionAttributeValues: {
        //   ":prefix": {S: "Мар"}
        //}, 
        //FilterExpression: "begins_with(patientName, :prefix)", 
      };  
      
      var search_prefix = $("input#patientSearchPrefix").val().toUpperCase();
      if (search_prefix.length > 0 ){
        params.ExpressionAttributeValues = {":prefix" : {S: search_prefix}};
        params.FilterExpression = "begins_with(patientName, :prefix)";
      }
      
      if (start_key != undefined)
        params.ExclusiveStartKey = start_key;
      
      executeDdbOperation(function(ddb){
        ddb.scan(params, function(err, data){
             if (err) console.warn(err, err.stack); // an error occurred
             else {
               console.debug(data);           // successful response
               data.Items.forEach(function (item){
                 $("div#patientList").append('<a href="#" class="list-group-item list-group-item-action py-0" data-toggle="list">'+item.patientName.S+'</a>');
               });

               //by default resul set from scan operation is limited to only fist 25 items.
               //uncomment following line to get all the item from the scan operations
               //if (data.LastEvaluatedKey != undefined) readPatientDB(data.LastEvaluatedKey); else 

               //once we are done, hook up event listener on every list item
                  $("div#patientList a").click(function(e){
                    e.preventDefault();
                    patientListItemClickedHandler($(this).html());
                  });
             }
        });
      });
    }
    
    function patientListItemClickedHandler(patientId){
      
      var params = {
        TableName: "patientDDB",
        Key: {
          "patientName" : {S: patientId}
        }
      }
      
      executeDdbOperation(function (ddb){
        ddb.getItem(params, function(err, data){
            if (err) console.warn(err, err.stack);  // an error occurred
            else {
              console.debug(data);                  // successful response
              visualizeExamData(data);
            }
        });
      });
    }
    
    function visualizeExamData(data){
      examType = data.Item.examType.S;
      
      if (examType == undefined){
        showInfo("Грешка", "Не дефиниран тип данни!");
        return;
      }
      var form = $("form#"+examType);
      var tab_pane = $("form#"+examType).parents("div.tab-pane");
      if (tab_pane == undefined || form == undefined){
        showInfo("Грешка", "Неизвестен тип данни");
        return;
      }
      
      $("a.nav-item#"+examType).tab("show");
      
      var examData = data.Item.examData.M;
      if (examData == undefined){
        showInfo("Грешка", "Неизвестен тип данни");
        return;        
      }
      
      form.find("input").val(""); //clear old data from all input fields before populatig data
      for (key in examData){
        console.debug (key, examData[key].S);
        form.find("input#"+key).val(examData[key].S);
      };
      
      
    }
      
    //calculate gestatational age of the baby
    function calculate_gv(){
        var today = new moment();
        var uzi_date = moment($("form#uzd input#exam_date").val());
        if (!uzi_date.isValid())
            uzi_date = new moment();
        var prm_date = moment($("form#uzd input#prm").val());
        if (prm_date.isValid() && prm_date <= uzi_date)
        {
          var gv=moment.duration(uzi_date.diff(prm_date));
          var gv_weeks=uzi_date.diff(prm_date, "weeks");
          var gv_days=uzi_date.diff(prm_date, "days")-7*gv_weeks;
          var vtr_date = prm_date.add(280, "d");//.add(9, "M");
          $("form#uzd input#gv_po_prm_weeks").val(gv_weeks);
          $("form#uzd input#gv_po_prm_days").val(gv_days);
          $("form#uzd input#vtr").val(vtr_date.format("YYYY-MM-DD"));
          //console.log("weeks", gv_weeks);
          //console.log("days", gv_days);
          //console.log("vtr", vtr_date.format());
        }
        else{
          console.log("user entered invalid date");
          $("form#uzd input#gv_po_prm_weeks").val("");
          $("form#uzd input#gv_po_prm_days").val("");
        }
      }
      
    
      //set up of all bimometric controls and related calculations
      $("select[purpose='biometric']").each(function(){
        var ga_dating_id = $(this).attr("ga_dating");
        var options = "";
        
        if (ga_dating_id == undefined){
          console.warn("missing 'ga_dating' attribute for ", this);
          return;
        }
        
        if (ga_dating_functions[ga_dating_id] == undefined){
          console.warn("missing 'ga_dating_function' for ", this);
          return;          
        }
        
        for (f in ga_dating_functions[ga_dating_id])
          options+="<option value='"+f+"'>"+ga_dating_functions[ga_dating_id][f].title+"</option>";
        $(this).append(options);
        $(this).change(function(){
          var f = $(this).val();
          $("span[purpose='biometric'][ga_dating='"+ga_dating_id+"']").html(ga_dating_functions[ga_dating_id][f].description);
          if (typeof(Storage) !== "undefined") {
            localStorage.setItem(ga_dating_id, f);
          } else {
            // Sorry! No Web Storage support..
            console.warn("Web Storage not supported...");
          }
          
          doBiometricCalc(ga_dating_id);
        });
        
        if (typeof(Storage) !== "undefined"){
          var f = localStorage.getItem(ga_dating_id);
          if (f != undefined && ga_dating_functions[ga_dating_id][f] != undefined)
            $(this).val(f);
          
          $(this).change();
        }
        
        $("input[purpose='biometric'][ga_dating='"+ga_dating_id+"-input']").keyup(function(){  
          doBiometricCalc(ga_dating_id);
        });
        $("input[purpose='biometric'][ga_dating='"+ga_dating_id+"-input']").change(function(){
          doBiometricCalc(ga_dating_id);
        });
      });
    
      function doBiometricCalc(ga_dating_id){
          var m = $("input[purpose='biometric'][ga_dating='"+ga_dating_id+"-input']").val();
          var f = $("select[purpose='biometric'][ga_dating='"+ga_dating_id+"']").val();
          var r = ga_dating_functions[ga_dating_id][f].calc(m);
          if (r != undefined && r!= null)
            $("input[purpose='biometric'][ga_dating='"+ga_dating_id+"-output']").val(ga_dating_functions[ga_dating_id][f].calc(m));        
      }
    
      $("form#uzd #bpd_mm").keyup(function(){
        calcHC();
      });
                         
      $("form#uzd #bpd_mm").change(function(){
        calcHC();
      });
      
      $("form#uzd #ofd_mm").keyup(function(){
        calcHC();
      });
                         
      $("form#uzd #ofd_mm").change(function(){
        calcHC();
      });
                         
      function calcHC(){
        var bpd = parseFloat($("form#uzd #bpd_mm").val());
        var ofd = parseFloat($("form#uzd #ofd_mm").val());
        var hc = 3.14*(bpd+ofd)/2.0;
        if (!Number.isNaN(hc)){
          $("form#uzd #hc_mm").val(Math.round(hc*100.0)/100.0);
          $("form#uzd #hc_mm").change();
        }
        else 
          $("form#uzd #hc_mm").val("");
      }
    
      $("form#uzd input#prm").change(function(){
          calculate_gv();
      });
      
      $("form#uzd input#exam_date").change(function(){
          calculate_gv();
      });
       
    
    function generateItemObject(form_id){
      var patientData = {};
      
      patientData.patientName = {S:$("form#"+form_id+" input#patient_name").val().toUpperCase()+" - "+
                                 $("form#"+form_id+" input#patient_egn").val()+"<br>"+
                                 $("a.nav-item#"+form_id).text() + " on " + 
                                 $("form#"+form_id+" input#exam_date").val()};
                                 //(new moment()).format("YYYY-MM-DD")};
      patientData.ttl = {N:(new moment()).add(patientRetentionPeriod, 'y').unix()+""};
      patientData.examType = {S:form_id};
      patientData.examData = {M:{}};
      $("form#"+form_id+" input").each(function(){
        var key = $(this).attr('id');
        var value = $(this).val();
        if (value != "")
          patientData.examData.M[key]={S:value};
      });
         
      return patientData;
    }
    
    $("button[save]").click(function() {
      savePatientInfo(true /*overwrite protect*/);
    });
    
    function savePatientInfo(overwriteProtect) {
      var form_id = $(this).parents("form").attr("id");
      if (form_id == undefined)
          form_id = $("div.tab-pane.active form").attr("id");
      var patient_name = $("form#"+form_id+" input#patient_name").val();
      var patient_egn = $("form#"+form_id+" input#patient_egn").val();
      
      if (patient_name.length == 0){// || patient_egn.length == 0) {
        showInfo("Липсваща информация", "Моля въведете име на пациент!")
        //alert("Моля въведете име на пациент!");
        return;
      }
      
      
      var item = generateItemObject(form_id);
      var params = {};
      params.TableName = "patientDDB";
      params.Item = item;
      if (overwriteProtect)
        params.ConditionExpression = "attribute_not_exists(patientName)"

      //uncomment next line if you want to get old item when putItem replaces existing item in DynamoDB
      //params.ReturnValues = "ALL_OLD";
      
      $("button[save]").prop("disabled", true);
       
      executeDdbOperation(function(ddb){
        ddb.putItem(params, function(err, data){
          $("button[save]").prop("disabled", false);
          if (err){
            console.warn("Error writing data in DB. error.code => ", err.code);
            if (err.code == "ConditionalCheckFailedException")
              showInfo("Внимание", "Вероятно дублиран запис.<br>Да продължа ли?", 
                       function(){ savePatientInfo(false /*no overwrite protect*/);});
            else
              showInfo("Грешка", "Грешка при запис!");
          }
          else{
            console.log("Data succesfully logged in DB", data);
            showInfo("Информация", "Успешен запис!");
          }

        });
      });
    };
    
    $("button[print]").click(function(){
      var h = $("form").css("height"); //temporary store the height property      
      $("form").css("height","");      
      window.print();      
      $("form").css("height",h);
    });
    
    function newPatient(){
      $("div.tab-pane.active input").val("");
      $("input#exam_date").val(new moment().format("YYYY-MM-DD"));
    }
    
    $("button[new]").click(function(){
      newPatient();
    });
    
    $("button[logout]").click(function(){
      var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
      var cognitoUser = userPool.getCurrentUser();
      
      if (cognitoUser != null){
        cognitoUser.signOut();
      }
    })
    
    $("button[access]").click(function(){
      var secretAccessKey = $("input#secretAccessKey").val();
      var accessKeyId = $("input#accessKeyId").val();
      
      if (secretAccessKey.length > 0 && accessKeyId.length > 0){
        localStorage.setItem("secretAccessKey", secretAccessKey);
        localStorage.setItem("accessKeyId", accessKeyId);
      }
    });
    
    $("input#patientSearchPrefix").keyup(function(e){
      if (e.which == 13) { //Enter pressed
        var s = $(this).val();
        if (s.length >= 0)
          propagatePatientList();
      }
    });
    
    
    function setupScrollers (){
      //sets up individual scrollers for left and right panes
      var navbar_outer_height = $("nav.navbar").outerHeight(true);
      var buttonsbar_outer_height = $("div[buttonsbar1]").outerHeight(true);
      var listHeader_outer_heigth = $("div[listHeader]").outerHeight(true);

      var offset = navbar_outer_height+buttonsbar_outer_height;
      $("form").css("height","calc(100vh - "+offset+"px");
      $("form").css("overflow-y","auto");
      
      offset = navbar_outer_height+listHeader_outer_heigth+10;
      $("div.list-group").css("height","calc(100vh - "+offset+"px");
      $("div.list-group").css("overflow-y","auto");
      
    }
    
    //Executes DynamoDB operation passed as argument. 
    //If needed user is asked for credentials
    function executeDdbOperation(op){
      console.debug("Start executing DynamoDB operation...");
      var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
      var dynamodb = new AWS.DynamoDB({
            apiVersion: '2012-08-10',
            dynamoDbCrc32: false,
            credentials: credentials,
          }); 
      
      if (credentials.needsRefresh()){
        console.log("Existing AWS credentials needs to be refreshed!");
        if (credentialsRefreshFailed)
          startAutheticationFlow();
        else{
          console.debug("Initiating AWS credentials refresh operation...");
          credentials.refresh((error) => {
              if (error) {
                console.error("Unable to refresh AWS credentials. Error: ", error);
                user.signOut();
                credentialsRefreshFailed = true;
                requestUserLoginInfo(op)
              } 
              else {
                console.debug('AWS credentials succesfully refreshed: ', credentials);
                credentialsRefreshFailed = false;
                if (op) op(dynamodb);

              }
          }); 
        }
      }
      else 
        //credentials seems valid, so execute requested dynamodb operation
        if (op) op(dynamodb);
      
      function startAutheticationFlow(){  
        console.debug("Tring to get current user from local browser storage...");
        var cognitoUser = userPool.getCurrentUser();

        if (cognitoUser == null)
          authenticateUser(userPool);
        else{
          console.debug("User succesfully retreived from local storage", cognitoUser);
          getAWSCredentials(cognitoUser);
        }
      }

      function authenticateUser(userPool){
        console.debug("No logged user found in local storage.");
        console.debug("User needs to enter his username and password...");
        
          var password = $("div.modal#modalLogin input#password").val();
          var user = $("div.modal#modalLogin input#user-name").val();
          
          if (password.length == 0){
              //we do not know the user password so ask for it.
              //pass as a parameter the intended DynamoDB operation 
              //After user enters his password we will try to execute it again.
              requestUserLoginInfo(op);
              return;
          }
          var authenticationData = {
                  Username : user,
                  Password : password,
              };
          var authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

          var userData = {
                  Username : authenticationData.Username,
                  Pool : userPool
              };

          var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
          //as we authenitcate new user, we clear any cached identities, just in case...
          credentials.clearCachedId();
        
          console.debug ("Authenticating new username and password");
        
          cognitoUser.authenticateUser(authenticationDetails, {
            onSuccess: function (result) {
              console.debug("User succesfully authenticated!", result);
              var idToken = result.idToken.jwtToken;
              credentials.params.Logins['cognito-idp.us-east-1.amazonaws.com/us-east-1_njMWzfgEG'] = 
                    idToken;
              console.debug("Requesting new AWS credentials...")
              credentials.get(function(error){
                    if (error) {
                      console.error("Requesting AWS credentials failed. Error: ", error);
                      cognitoUser.signOut();
                      credentialsRefreshFailed = true;
                      requestUserLoginInfo(op)
                    } 
                    else {
                      console.debug('AWS credentials succesfully obtained: ', credentials);
                      credentialsRefreshFailed = false;
                      if (op) op(dynamodb);
                    }
                });

              //var accessToken = result.getAccessToken().getJwtToken();
              /* Use the idToken for Logins Map when Federating User Pools with identity pools or when passing through an Authorization Header to an API Gateway Authorizer */
              //var idToken = result.idToken.jwtToken;
            },
            newPasswordRequired: function(userAttributes, requiredAttributes) {
              console.debug("New user. Password needs to be confirmed.");
                // User was signed up by an admin and must provide new 
                // password and required attributes, if any, to complete 
                // authentication.

                // userAttributes: object, which is the user's current profile. It will list all attributes that are associated with the user. 
                // Required attributes according to schema, which don’t have any values yet, will have blank values.
                // requiredAttributes: list of attributes that must be set by the user along with new password to complete the sign-in.

                // Get these details and call 
                // newPassword: password that user has given
                // attributesData: object with key as attribute name and value that the user has given.
                var attributesData = {};
                var newPassword = password;
                cognitoUser.completeNewPasswordChallenge(newPassword, attributesData, this);
            },        
            onFailure: function(err) {
              console.log("User authentication failure:", err.message, err);
              //showInfo("Грешка", "Грешка при оторизация.<br>Въведохте ли вярна парола?");
              //user have entered wrong password. clear it and re-attempt to execute to op again
              requestUserLoginInfo(op);
            }
          });
        }

      function getAWSCredentials(user){

          if (user != null) {
            user.getSession(function(err, session) {
              if (session && session.isValid()) {
                console.debug('Valid user session was retrieved:');
                console.debug("session: ", session);

                credentials.params.Logins['cognito-idp.us-east-1.amazonaws.com/us-east-1_njMWzfgEG'] = 
                    session.getIdToken().getJwtToken();
                
                //call refresh method in order to authenticate user and get new temp credentials
                
                console.log("Refreshing AWS credentials for the retrieved user session...");
                credentials.refresh((error) => {
                    if (error) {
                      console.error("Unable to refresh AWS credentials. Error: ", error);
                      user.signOut();
                      credentialsRefreshFailed = true;
                      requestUserLoginInfo(op)
                    } 
                    else {
                      console.debug('AWS credentials succesfully refreshed: ', credentials);
                      credentialsRefreshFailed = false;
                      if (op) op(dynamodb);
                    }
                });
              }
              else {//(session && session.isValid())
                console.error("Unable to retrieve user session for user: ", user);
                console.error("following error occurred", err);
                //showInfo("Грешка", "Възникна грешка.<br>Презаредете страницата и опитайте отново!")
                user.signOut();
                requestUserLoginInfo(op)
              }
            });
          }
          else { //(user != null)
            console.error("Unrecoverable error. Unable to retrieve user session for null user");
            showInfo("Грешка", "Възникна грешка.<br>Презаредете страницата и опитайте отново!");
          }
        }
    }
    
    $(function(){
      propagatePatientList();
      newPatient();
      setupScrollers();
      //executeDdbOperation(null);
    });
    
  </script>
</body>
</html>